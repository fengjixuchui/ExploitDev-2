#include <Windows.h>
#include <stdio.h>
#include <stdint.h>

int32_t wmain(int32_t nArgc, const wchar_t* pArgv[]) {
	PROCESS_MITIGATION_DYNAMIC_CODE_POLICY AcgPolicy = { 0 };
	PROCESS_MITIGATION_BINARY_SIGNATURE_POLICY CigPolicy = { 0 };
	PROCESS_MITIGATION_IMAGE_LOAD_POLICY ImageLoadPolicy = { 0 };
	
	AcgPolicy.ProhibitDynamicCode = 1;
	CigPolicy.MicrosoftSignedOnly = 1;
	ImageLoadPolicy.NoLowMandatoryLabelImages = 1;
	ImageLoadPolicy.NoRemoteImages = 1;

	printf("... current PID: %d\r\n", GetCurrentProcessId());

	if (SetProcessMitigationPolicy(ProcessDynamicCodePolicy, &AcgPolicy, sizeof(AcgPolicy))) {
		printf("... successfully set ACG mitigation policy\r\n");

		if (SetProcessMitigationPolicy(ProcessSignaturePolicy, &CigPolicy, sizeof(CigPolicy))) {
			printf("... successfully set CIG mitigation policy\r\n");
		}
		if (SetProcessMitigationPolicy(ProcessImageLoadPolicy, &ImageLoadPolicy, sizeof(ImageLoadPolicy))) {
			printf("... successfully set image load mitigation policy\r\n");
		}
	}

	system("pause");
	return 0;
}