#include <Windows.h>
#include <stdint.h>
#include <stdio.h>
#include <comdef.h>

#include "IHelloWorld.hpp"
#include "DllServer.h"
#include "LocalServer.h"

int32_t wmain(int32_t nArgc, const wchar_t *pArgv[])
{
    IHelloWorld* pHelloWorld;
    HRESULT hr;

    CoInitialize(NULL);
    /*
    hr = CoCreateInstance(__uuidof(MyInProcServer), NULL, CLSCTX_INPROC_SERVER,
        __uuidof(IHelloWorld), (void**)&pIMsgBox);

    if (FAILED(hr)) {
        printf("... failed to create instance (error 0x%08x)\r\n", hr);
        return 0;
    }

    pIMsgBox->HelloWorld(_bstr_t("Hello COM!"));
    pIMsgBox->Release();
    */

    IClassFactory* pICF = NULL;

    hr = CoGetClassObject(__uuidof(MyLocalServer), CLSCTX_LOCAL_SERVER, NULL, IID_IClassFactory, (void**)&pICF);
    if (!FAILED(hr))
    {
        printf("... successfully obtained local server factory class\r\n");
    }
    else {
        printf("... failed to obtain local server factory class (error 0x%08x)\r\n", hr);
    }

    return 0;
}
